<mujoco model="pidog">
  <compiler angle="radian" coordinate="local" inertiafromgeom="false"/>

  <option timestep="0.02" iterations="50" solver="Newton" jacobian="dense">
    <flag warmstart="enable"/>
  </option>

  <default>
    <joint axis="0 0 1" limited="true" damping="0.5" armature="0.01"/>
    <geom contype="1" conaffinity="1" condim="3" friction="0.8 0.005 0.0001"
          rgba="0.8 0.6 0.4 1"/>
    <motor ctrllimited="true" ctrlrange="-1.57 1.57"/>
  </default>

  <asset>
    <texture name="grid" type="2d" builtin="checker" rgb1="0.3 0.3 0.3"
             rgb2="0.4 0.4 0.4" width="512" height="512"/>
    <material name="grid" texture="grid" texrepeat="1 1" reflectance="0.1"/>
  </asset>

  <worldbody>
    <light pos="0 0 1.5" dir="0 0 -1" diffuse="1 1 1"/>
    <geom name="floor" type="plane" size="5 5 0.1" material="grid"/>

    <!-- Main body -->
    <body name="torso" pos="0 0 0.1">
      <freejoint/>
      <inertial pos="0 0 0" mass="0.3"
                diaginertia="3.85e-4 1.60e-4 3.45e-4"/>
      <geom name="torso_geom" type="box" size="0.05 0.05 0.05"
            rgba="0.4 0.4 0.8 1"/>

      <!-- ========== SENSORS ========== -->
      <!-- Camera (320x240, 30Hz) on front of head -->
      <camera name="head_camera" pos="0.06 0 0.02" quat="0.7071 0 0 0.7071" fovy="60"/>

      <!-- Ultrasonic rangefinder site (HC-SR04) - forward facing -->
      <site name="ultrasonic_site" pos="0.055 0 0.015" size="0.003" rgba="1 0 0 0.5"/>

      <!-- Head touch sensor site (on top of head) -->
      <site name="head_touch_site" pos="0.04 0 0.03" size="0.01" rgba="0 1 0 0.5"/>

      <!-- ========== BACK RIGHT LEG ========== -->
      <body name="br_upper" pos="0.0405 -0.06685 -0.009">
        <joint name="br_shoulder" type="hinge" axis="0 1 0"
               range="-1.57 1.57" damping="0.5"/>
        <inertial pos="0.021 0 0" mass="0.010"
                  diaginertia="2.58e-7 2.78e-6 3.03e-6"/>
        <geom name="br_upper_geom" type="capsule" size="0.008"
              fromto="0 0 0 0.042 0 0" rgba="0.8 0.3 0.3 1"/>

        <body name="br_lower" pos="0.042 0 0">
          <joint name="br_knee" type="hinge" axis="0 0 1"
                 range="-1.57 1.57" damping="0.5"/>
          <inertial pos="0.038 0 0" mass="0.010"
                    diaginertia="2.58e-7 2.78e-6 3.03e-6"/>
          <geom name="br_lower_geom" type="capsule" size="0.008"
                fromto="0 0 0 0.076 0 0" rgba="0.8 0.3 0.3 1"/>

          <body name="br_foot" pos="0.076 0 0">
            <inertial pos="0 0 0" mass="0.003"
                      diaginertia="1.64e-8 6.52e-8 7.99e-8"/>
            <geom name="br_foot_geom" type="sphere" size="0.008"
                  rgba="0.2 0.2 0.2 1" friction="1.0 0.005 0.0001"/>
            <site name="br_foot_site" pos="0 0 -0.008" size="0.005"/>
          </body>
        </body>
      </body>

      <!-- ========== FRONT RIGHT LEG ========== -->
      <body name="fr_upper" pos="0.0405 0.05315 -0.009">
        <joint name="fr_shoulder" type="hinge" axis="0 1 0"
               range="-1.57 1.57" damping="0.5"/>
        <inertial pos="0.021 0 0" mass="0.010"
                  diaginertia="2.58e-7 2.78e-6 3.03e-6"/>
        <geom name="fr_upper_geom" type="capsule" size="0.008"
              fromto="0 0 0 0.042 0 0" rgba="0.8 0.3 0.3 1"/>

        <body name="fr_lower" pos="0.042 0 0">
          <joint name="fr_knee" type="hinge" axis="0 0 1"
                 range="-1.57 1.57" damping="0.5"/>
          <inertial pos="0.038 0 0" mass="0.010"
                    diaginertia="2.58e-7 2.78e-6 3.03e-6"/>
          <geom name="fr_lower_geom" type="capsule" size="0.008"
                fromto="0 0 0 0.076 0 0" rgba="0.8 0.3 0.3 1"/>

          <body name="fr_foot" pos="0.076 0 0">
            <inertial pos="0 0 0" mass="0.003"
                      diaginertia="1.64e-8 6.52e-8 7.99e-8"/>
            <geom name="fr_foot_geom" type="sphere" size="0.008"
                  rgba="0.2 0.2 0.2 1" friction="1.0 0.005 0.0001"/>
            <site name="fr_foot_site" pos="0 0 -0.008" size="0.005"/>
          </body>
        </body>
      </body>

      <!-- ========== BACK LEFT LEG ========== -->
      <body name="bl_upper" pos="-0.0405 -0.06685 -0.009">
        <joint name="bl_shoulder" type="hinge" axis="0 1 0"
               range="-1.57 1.57" damping="0.5"/>
        <inertial pos="-0.021 0 0" mass="0.010"
                  diaginertia="2.58e-7 2.78e-6 3.03e-6"/>
        <geom name="bl_upper_geom" type="capsule" size="0.008"
              fromto="0 0 0 -0.042 0 0" rgba="0.3 0.8 0.3 1"/>

        <body name="bl_lower" pos="-0.042 0 0">
          <joint name="bl_knee" type="hinge" axis="0 0 1"
                 range="-1.57 1.57" damping="0.5"/>
          <inertial pos="-0.038 0 0" mass="0.010"
                    diaginertia="2.58e-7 2.78e-6 3.03e-6"/>
          <geom name="bl_lower_geom" type="capsule" size="0.008"
                fromto="0 0 0 -0.076 0 0" rgba="0.3 0.8 0.3 1"/>

          <body name="bl_foot" pos="-0.076 0 0">
            <inertial pos="0 0 0" mass="0.003"
                      diaginertia="1.64e-8 6.52e-8 7.99e-8"/>
            <geom name="bl_foot_geom" type="sphere" size="0.008"
                  rgba="0.2 0.2 0.2 1" friction="1.0 0.005 0.0001"/>
            <site name="bl_foot_site" pos="0 0 -0.008" size="0.005"/>
          </body>
        </body>
      </body>

      <!-- ========== FRONT LEFT LEG ========== -->
      <body name="fl_upper" pos="-0.0405 0.05315 -0.009">
        <joint name="fl_shoulder" type="hinge" axis="0 1 0"
               range="-1.57 1.57" damping="0.5"/>
        <inertial pos="-0.021 0 0" mass="0.010"
                  diaginertia="2.58e-7 2.78e-6 3.03e-6"/>
        <geom name="fl_upper_geom" type="capsule" size="0.008"
              fromto="0 0 0 -0.042 0 0" rgba="0.3 0.8 0.3 1"/>

        <body name="fl_lower" pos="-0.042 0 0">
          <joint name="fl_knee" type="hinge" axis="0 0 1"
                 range="-1.57 1.57" damping="0.5"/>
          <inertial pos="-0.038 0 0" mass="0.010"
                    diaginertia="2.58e-7 2.78e-6 3.03e-6"/>
          <geom name="fl_lower_geom" type="capsule" size="0.008"
                fromto="0 0 0 -0.076 0 0" rgba="0.3 0.8 0.3 1"/>

          <body name="fl_foot" pos="-0.076 0 0">
            <inertial pos="0 0 0" mass="0.003"
                      diaginertia="1.64e-8 6.52e-8 7.99e-8"/>
            <geom name="fl_foot_geom" type="sphere" size="0.008"
                  rgba="0.2 0.2 0.2 1" friction="1.0 0.005 0.0001"/>
            <site name="fl_foot_site" pos="0 0 -0.008" size="0.005"/>
          </body>
        </body>
      </body>
    </body>
  </worldbody>

  <actuator>
    <!-- Position servos with torque limits matching real hardware (0.15 Nm) -->
    <position name="br_shoulder_act" joint="br_shoulder"
              ctrlrange="-1.57 1.57" kp="150" kv="10"/>
    <position name="br_knee_act" joint="br_knee"
              ctrlrange="-1.57 1.57" kp="150" kv="10"/>
    <position name="fr_shoulder_act" joint="fr_shoulder"
              ctrlrange="-1.57 1.57" kp="150" kv="10"/>
    <position name="fr_knee_act" joint="fr_knee"
              ctrlrange="-1.57 1.57" kp="150" kv="10"/>
    <position name="bl_shoulder_act" joint="bl_shoulder"
              ctrlrange="-1.57 1.57" kp="150" kv="10"/>
    <position name="bl_knee_act" joint="bl_knee"
              ctrlrange="-1.57 1.57" kp="150" kv="10"/>
    <position name="fl_shoulder_act" joint="fl_shoulder"
              ctrlrange="-1.57 1.57" kp="150" kv="10"/>
    <position name="fl_knee_act" joint="fl_knee"
              ctrlrange="-1.57 1.57" kp="150" kv="10"/>
  </actuator>

  <sensor>
    <!-- ========== IMU (MPU6050 on body) ========== -->
    <!-- 6-axis IMU: 3-axis accelerometer + 3-axis gyroscope -->
    <framequat name="imu_quat" objtype="body" objname="torso"/>
    <framepos name="imu_pos" objtype="body" objname="torso"/>
    <framelinvel name="imu_linvel" objtype="body" objname="torso"/>
    <frameangvel name="imu_angvel" objtype="body" objname="torso"/>
    <framelinacc name="imu_linacc" objtype="body" objname="torso"/>
    <frameangacc name="imu_angacc" objtype="body" objname="torso"/>

    <!-- ========== Joint Position/Velocity Sensors ========== -->
    <!-- For servo feedback (real servos have position encoders) -->
    <jointpos name="br_shoulder_pos" joint="br_shoulder"/>
    <jointpos name="br_knee_pos" joint="br_knee"/>
    <jointpos name="fr_shoulder_pos" joint="fr_shoulder"/>
    <jointpos name="fr_knee_pos" joint="fr_knee"/>
    <jointpos name="bl_shoulder_pos" joint="bl_shoulder"/>
    <jointpos name="bl_knee_pos" joint="bl_knee"/>
    <jointpos name="fl_shoulder_pos" joint="fl_shoulder"/>
    <jointpos name="fl_knee_pos" joint="fl_knee"/>

    <jointvel name="br_shoulder_vel" joint="br_shoulder"/>
    <jointvel name="br_knee_vel" joint="br_knee"/>
    <jointvel name="fr_shoulder_vel" joint="fr_shoulder"/>
    <jointvel name="fr_knee_vel" joint="fr_knee"/>
    <jointvel name="bl_shoulder_vel" joint="bl_shoulder"/>
    <jointvel name="bl_knee_vel" joint="bl_knee"/>
    <jointvel name="fl_shoulder_vel" joint="fl_shoulder"/>
    <jointvel name="fl_knee_vel" joint="fl_knee"/>

    <!-- ========== Foot Contact/Force Sensors ========== -->
    <!-- Touch sensors on foot pads (for gait phase detection) -->
    <touch name="br_foot_contact" site="br_foot_site"/>
    <touch name="fr_foot_contact" site="fr_foot_site"/>
    <touch name="bl_foot_contact" site="bl_foot_site"/>
    <touch name="fl_foot_contact" site="fl_foot_site"/>

    <!-- ========== Ultrasonic Rangefinder (HC-SR04 simulation) ========== -->
    <!-- Mounted on head, forward-facing (0.02-4m range) -->
    <rangefinder name="ultrasonic" site="ultrasonic_site"/>

    <!-- ========== Head Touch Sensor ========== -->
    <touch name="head_touch" site="head_touch_site"/>
  </sensor>
</mujoco>